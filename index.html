<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Analysis Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeo5sV7Z4U6L/9W+K4U5t6L5K5kK4l2B8GQJ3XU5K8Kp6jzV" crossorigin="anonymous">
  <!-- Custom Styles -->
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      margin-top: 2rem;
    }
    #results-display {
      margin-top: 2rem;
    }
    canvas {
      max-width: 100%;
      height: auto;
    }
    .table-responsive {
      max-height: 400px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mt-4 text-center">Data Analysis Dashboard</h1>

    <!-- Input Card -->
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="row g-3 align-items-center">
          <div class="col-md-8">
            <label for="data-input" class="form-label">Upload CSV File</label>
            <input type="file" class="form-control" id="data-input" accept=".csv,text/csv">
          </div>
          <div class="col-md-4 d-grid">
            <button class="btn btn-primary mt-4" id="process-btn">Analyze</button>
          </div>
        </div>
        <div id="alert-placeholder" class="mt-3"></div>
      </div>
    </div>

    <!-- Results Section -->
    <div id="results-display" class="mt-4">
      <!-- Statistics Table -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          Summary Statistics
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped mb-0" id="stats-table">
              <thead class="table-light">
                <tr>
                  <th>Column</th>
                  <th>Count</th>
                  <th>Mean</th>
                  <th>Min</th>
                  <th>Max</th>
                </tr>
              </thead>
              <tbody>
                <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          Data Visualization
        </div>
        <div class="card-body">
          <canvas id="data-chart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-q2gy5c2eU+Kf5z0pQK5I1QwKf5fZ4K6p6k2l9e5g5l6k6j6k6l6m6n6o6p6q6r6s"
          crossorigin="anonymous"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script>
    // Helper: Show Bootstrap alert
    function showAlert(message, type = 'danger') {
      const placeholder = document.getElementById('alert-placeholder');
      placeholder.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>`;
    }

    // Compute basic stats for numeric arrays
    function computeStats(values) {
      const count = values.length;
      const sum = values.reduce((a, b) => a + b, 0);
      const mean = sum / count;
      const min = Math.min(...values);
      const max = Math.max(...values);
      return { count, mean: mean.toFixed(2), min, max };
    }

    // Render stats table
    function renderStatsTable(stats) {
      const tbody = document.querySelector('#stats-table tbody');
      tbody.innerHTML = '';
      for (const col in stats) {
        const s = stats[col];
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${col}</td>
          <td>${s.count}</td>
          <td>${s.mean}</td>
          <td>${s.min}</td>
          <td>${s.max}</td>`;
        tbody.appendChild(row);
      }
    }

    // Render chart for the first numeric column
    function renderChart(labels, data, columnName) {
      const ctx = document.getElementById('data-chart').getContext('2d');
      if (window.myChart) {
        window.myChart.destroy();
      }
      window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: columnName,
            data,
            borderColor: 'rgba(75,192,192,1)',
            backgroundColor: 'rgba(75,192,192,0.2)',
            fill: true,
            tension: 0.2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            tooltip: { mode: 'index', intersect: false }
          },
          scales: {
            x: { display: true, title: { display: true, text: 'Row' } },
            y: { display: true, title: { display: true, text: columnName } }
          }
        }
      });
    }

    // Main processing function
    document.getElementById('process-btn').addEventListener('click', () => {
      const fileInput = document.getElementById('data-input');
      const file = fileInput.files[0];

      // Basic validation
      if (!file) {
        showAlert('Please select a CSV file to analyze.');
        return;
      }
      if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
        showAlert('Invalid file type. Please upload a CSV file.');
        return;
      }

      // Read file
      const reader = new FileReader();
      reader.onload = (e) => {
        const csvText = e.target.result;
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          dynamicTyping: true,
          complete: (results) => {
            if (results.errors.length) {
              showAlert('Error parsing CSV: ' + results.errors[0].message);
              return;
            }
            const data = results.data;
            if (!data.length) {
              showAlert('CSV appears to be empty.');
              return;
            }

            // Determine numeric columns
            const firstRow = data[0];
            const numericCols = Object.keys(firstRow).filter(col => typeof firstRow[col] === 'number');

            if (!numericCols.length) {
              showAlert('No numeric columns found for analysis.');
              return;
            }

            // Compute stats per numeric column
            const stats = {};
            numericCols.forEach(col => {
              const values = data.map(row => row[col]).filter(v => typeof v === 'number' && !isNaN(v));
              stats[col] = computeStats(values);
            });
            renderStatsTable(stats);

            // Prepare chart data for the first numeric column
            const chartCol = numericCols[0];
            const chartValues = data.map(row => row[chartCol]);
            const labels = chartValues.map((_, i) => i + 1);
            renderChart(labels, chartValues, chartCol);
          },
          error: (err) => {
            showAlert('Failed to parse CSV: ' + err.message);
          }
        });
      };
      reader.onerror = () => {
        showAlert('Failed to read the file.');
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>